###Preprocessing ScanM imaging data (with IgorPRO)

Import and export hdf5 files from Igor. Import these hdf5 files to Python.


####Prerequisites

- the HDF5 Loader is installed (shortcuts to the files starting with ``...\Wavemetrics\...\More Extensions\File Loaders\HDF5`` need to be present in ``...\User\...\WaveMetrics\Igor Pro 6 User Files\Igor Extensions``)

- SARFIA is installed (see http://www.igorexchange.com/project/SARFIA)

- the ScanM file loader is installed (see ``ret_preprocessing/ScM/ScanM_FileIO``)


#### Installing OS scripts

1. Copy all "OS" scripts into your User Procedures in My Documents

2. Copy a shortcut for "OS_GUI"` to Igor Procedures

3. Restart Igor for changes to take effect


#### Using OS scripts (Igor)

1. Run the function `"OS_GUI()"`. If you have followed the instructions listed above, this should open the GUI in Igor.

2. Execute OS functions by clicking sequentially through the buttons on the GUI

  1. `Load Parameter Table`: Creates table containing the parameters which control subsequent preprocessing scripts

  2. ROI placement can be done with either `Manually` + `Apply` or `Autom. by Correlation`

  3. `Traces & Triggers` then extracts traces and triggers from the raw data

  4. Optional: `Basic Averaging` performs some simple statics and plots the ROIs in Igor

  5. `Export for database` then exports files from your current data folder to the folder specified in the procedure.

    1. It is recommended that you modify the Export for database procedure before using it

    2. Open procedure OS_hdf5Export.ipf

    3. Modify targetPath to match the directory you would like to export the file to

    4. Modify the string at the end of the line `HDF5CreateFile` to the name of the file you export

    5. The waves after HDF5SaveData are then saved inside a HDF5 file at the specified directory

3. The following waves are exported:

  1. OS_Parameters: The parameters generated by the `Load Parameter Table` function

  2. ROIs: The ROI mask used to extract the traces

  3. Traces0_raw: The traces extracted using the ROI mask without normalisation

  4. Traces0_znorm: Traces0_raw but with normalisation

  5. Tracestimes0: Timestamp for each frame of each ROI (Dimension = Traces0_raw)

  6. Triggertimes: Time (s) when trigger detected

  7. Triggervalues: Peak value of a triggering event. Currently static.
